<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô - eFinder</title>
</head>
<body class="bg-black min-h-screen flex items-center justify-center px-4">
  <div class="max-w-md w-full bg-zinc-900 text-white rounded-lg shadow-lg p-6 space-y-4">
    <div class="flex items-center space-x-2 mb-4">
      <img src="logo.png" alt="eFinder Logo" class="w-10 h-10" />
      <span class="text-lg font-bold">eFinder</span>
    </div>

    <h2 class="text-xl font-bold">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>

    <hr class="border-zinc-700 my-6" />

    <!-- Email -->
    <div>
      <label class="block text-sm font-semibold mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•*</label>
      <input type="email" id="email" class="w-full bg-zinc-800 border border-yellow-400 rounded-md px-4 py-2" placeholder="example@email.com" required />
      <p id="emailError" class="text-red-400 text-sm mt-1 hidden"></p>
    </div>

    <!-- New Password -->
    <div>
      <label class="block text-sm font-semibold mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà*</label>
      <div class="relative">
        <input type="password" id="newPassword" class="w-full bg-zinc-800 border border-yellow-400 rounded-md px-4 py-2 pr-10" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" required />
        <button type="button" onclick="togglePassword('newPassword')" class="absolute right-2 top-2 text-sm text-yellow-400">üëÅ</button>
      </div>
      <p id="newPasswordError" class="text-red-400 text-sm mt-1 hidden"></p>
    </div>

    <!-- Confirm Password -->
    <div>
      <label class="block text-sm font-semibold mb-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà*</label>
      <div class="relative">
        <input type="password" id="confirmPassword" class="w-full bg-zinc-800 border border-yellow-400 rounded-md px-4 py-2 pr-10" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required />
        <button type="button" onclick="togglePassword('confirmPassword')" class="absolute right-2 top-2 text-sm text-yellow-400">üëÅ</button>
      </div>
      <p id="confirmPasswordError" class="text-red-400 text-sm mt-1 hidden"></p>
    </div>

    <hr class="border-zinc-700 my-6" />

    <!-- Submit -->
    <button onclick="submitReset()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-2 px-4 rounded">
      ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    </button>

    <!-- Link ‡∏Å‡∏•‡∏±‡∏ö -->
    <p class="text-sm text-zinc-400 text-center mt-2">
      <a href="vendor-page_1.html" class="text-zinc-400 hover:underline">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
    </p>
  </div>

  <script>
    function togglePassword(id) {
      const input = document.getElementById(id);
      input.type = input.type === "password" ? "text" : "password";
    }

    function showError(id, message) {
      const el = document.getElementById(id);
      el.textContent = message;
      el.classList.remove("hidden");
    }

    function hideError(id) {
      document.getElementById(id).classList.add("hidden");
    }

    function submitReset() {
      const email = document.getElementById("email").value.trim();
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      ["emailError", "newPasswordError", "confirmPasswordError"].forEach(hideError);

      let isValid = true;

      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        showError("emailError", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        isValid = false;
      }

      if (newPassword.length < 8) {
        showError("newPasswordError", "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£");
        isValid = false;
      }

      if (newPassword !== confirmPassword) {
        showError("confirmPasswordError", "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
        isValid = false;
      }

      if (!isValid) return;

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å webhook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á OTP ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        fetch("https://chayang-n8n-app.onrender.com/webhook/reset-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, newPassword }) // ‚úÖ ‡πÅ‡∏ô‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
        })
        .then(res => res.json())
        .then(data => {
        if (data.success) {
            localStorage.setItem("otpSessionId", data.otpSessionId);
            localStorage.setItem("otpEmail", email);
            localStorage.setItem("otpNewPassword", newPassword);
            localStorage.setItem("otpFlow", "reset");
            window.location.href = "verify-otp.html";
        } else {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÑ‡∏´‡∏ô‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á error ‡∏ï‡∏≤‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏±‡πâ‡∏ô
            if (data.exists?.email) {
            showError("emailError", data.message || "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ");
            }
            if (data.exists?.password) {
            showError("newPasswordError", data.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ");
            }

            // fallback ‡πÅ‡∏™‡∏î‡∏á alert ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÑ‡∏´‡∏ô‡∏ï‡∏£‡∏á‡πÄ‡∏•‡∏¢
            if (!data.exists?.email && !data.exists?.password) {
            alert(data.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ");
            }
        }
        })

        .catch(err => {
          console.error(err);
          alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ");
        });
    }
  </script>
</body>
</html>
