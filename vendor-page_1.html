<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö - eFinder</title>
</head>

<body class="bg-black min-h-screen flex items-center justify-center px-4">
  <div class="max-w-md w-full bg-zinc-900 text-white rounded-lg shadow-lg p-6 space-y-4">
    <div class="flex items-center space-x-2 mb-4">
      <img src="logo.png" alt="eFinder Logo" class="w-10 h-10" />
      <span class="text-lg font-bold">eFinder</span>
    </div>

    <h1 class="text-xl font-bold text-white">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ã‡∏∑‡πâ‡∏≠-‡∏Ç‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Å‡∏° <span class="text-white">eFootball Mobile</span></h1>

    <div class="flex items-center space-x-2 text-zinc-400 text-sm">
      <span>üì±</span>
      <span>(‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢)</span>
    </div>

    <hr class="border-zinc-700 my-6" />
    
    <div>
      <!-- Username -->
      <div>
        <label for="username" class="block text-sm font-semibold mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô*</label>
        <input type="text" id="username" class="w-full bg-zinc-800 text-white border border-yellow-400 rounded-md px-4 py-2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" />
        <p id="usernameError" class="text-red-400 text-sm mt-1 hidden"></p>
      </div>

      <!-- Password Input -->
      <div class="mt-4">
        <div class="flex justify-between items-center mb-1">
          <label for="password" class="text-sm font-semibold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô*</label>
        </div>
        <div class="relative">
          <input type="password" id="password" class="w-full bg-zinc-800 text-white border border-yellow-400 rounded-md px-4 py-2 pr-10" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
          <button type="button" onclick="togglePassword()" class="absolute right-2 top-2 text-sm text-yellow-400">üëÅ</button>
        </div>
        <p id="passwordError" class="text-red-400 text-sm mt-1 hidden"></p>
      </div>

      <!-- User ID -->
      <div class="mt-4">
        <label for="user_id" class="block text-sm font-semibold mb-1">User ID*</label>
        <input type="text" id="user_id" class="w-full bg-zinc-800 text-white border border-yellow-400 rounded-md px-4 py-2" placeholder="ABCD-123-456-789" />
        <p id="userIdError" class="text-red-400 text-sm mt-1 hidden"></p>
      </div>

      <!-- <hr class="border-zinc-700 my-6" /> -->
      
      <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô + ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      <div class="flex justify-between items-center text-sm text-zinc-400 mt-2">
        <span>
          ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? 
          <a href="signup.html" class="text-yellow-400 hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
        </span>
        <a href="reset-password.html" class="text-yellow-400 hover:underline">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
      </div>

      <!-- Login Button -->
      <button id="loginBtn" type="button" class="mt-6 w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-2 px-4 rounded" onclick="login()">
        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>
  </div>

  <script>
    function togglePassword() {
      const input = document.getElementById("password");
      input.type = input.type === "password" ? "text" : "password";
    }

    function showError(id, message) {
      const el = document.getElementById(id);
      el.textContent = message;
      el.classList.remove("hidden");
    }

    function hideError(id) {
      document.getElementById(id).classList.add("hidden");
    }

    let loginFailCount = parseInt(localStorage.getItem("loginFailCount") || "0", 10);
    let loginBlockedUntil = parseInt(localStorage.getItem("loginBlockedUntil") || "0", 10);

    function updateLoginButton() {
      const now = Date.now();
      const btn = document.getElementById("loginBtn");

      if (now < loginBlockedUntil) {
        const remaining = Math.ceil((loginBlockedUntil - now) / 1000);
        btn.disabled = true;
        btn.classList.add("opacity-50", "cursor-not-allowed");
        btn.textContent = `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠ ${remaining} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...`;
      } else {
        btn.disabled = false;
        btn.classList.remove("opacity-50", "cursor-not-allowed");
        btn.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
      }
    }

    setInterval(updateLoginButton, 1000);
    window.addEventListener("DOMContentLoaded", () => {
      updateLoginButton();
      document.getElementById("username").value = localStorage.getItem("username") || "";
      document.getElementById("user_id").value = localStorage.getItem("user_id") || "";
    });

    function login() {
      const now = Date.now();
      const loginBlockedUntil = parseInt(localStorage.getItem("loginBlockedUntil") || "0", 10);

      if (now < loginBlockedUntil) {
        alert(`‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏≠‡∏µ‡∏Å ${(Math.ceil((loginBlockedUntil - now) / 1000))} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`);
        updateLoginButton(); // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
        return;
      }

      const username = document.getElementById("username").value.trim();
      const userId = document.getElementById("user_id").value.trim();
      const password = document.getElementById("password").value.trim();

      ["usernameError", "userIdError", "passwordError"].forEach(hideError);

      if (!username) {
        showError("usernameError", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
        return;
      }
      if (!userId) {
        showError("userIdError", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å User ID");
        return;
      }
      if (!password) {
        showError("passwordError", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
        return;
      }

      fetch("https://chayang-n8n-app.onrender.com/webhook/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, userId, password })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            localStorage.removeItem("loginFailCount");
            localStorage.removeItem("loginBlockedUntil");
            localStorage.setItem("username", username);
            localStorage.setItem("user_id", userId);
            window.location.href = "select-update_or_sell.html";
          } else {
            let loginFailCount = parseInt(localStorage.getItem("loginFailCount") || "0", 10);
            loginFailCount++;
            localStorage.setItem("loginFailCount", loginFailCount.toString());

            if (loginFailCount >= 5) {
              const blockDuration = 5 * 60 * 1000; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ
              const until = Date.now() + blockDuration;
              localStorage.setItem("loginBlockedUntil", until.toString());
              updateLoginButton();
              alert("‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß 5 ‡∏ô‡∏≤‡∏ó‡∏µ");
            } else {
              const msg = data.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô";
              showError("passwordError", msg);
            }
          }
        })
        .catch(err => {
          console.error(err);
          alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ");
        });
    }

  </script>
</body>
</html>
